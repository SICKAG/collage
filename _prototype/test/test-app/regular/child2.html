<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Child 2</title>
</head>

<style>
  body {
    background-color: lightseagreen;
    height: 100%;
    width: 100%;
  }

  html {
    height: 100%;
    width: 100%;
  }

  .iframe-container {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 100%;
    /* padding-top: 56.25%; */
    /* 16:9 Aspect Ratio (divide 9 by 16 = 0.5625) */
  }

  .responsive-iframe {
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>

<body>
  <script type="module">
    import { _internal_expose as expose } from "../../../bundle/collage.js";

    let context;

    const services = [
      {
        id: 'notification',
        version: '0.0.0',
        impl: (msg) => { alert(msg) }
      },
      {
        id: '2',
        version: '0.0.0',
        impl: () => { return 'CHILD 2: this is a child2 test service 2' }
      },
      {
        id: 'child2',
        version: '0.0.0',
        impl: () => { return 'CHILD 2: this is a child2 test service child2'; }
      },
      {
        id: 'time',
        version: '0.0.0',
        impl: (method, args) => {
          console.log('not implemented yet');
        }
      }
    ];

    expose(services, [])
      .then((ctx) => {
        document.querySelector("#contextId").innerHTML = ctx.contextId;
        document.getElementById("btn2").addEventListener('click', () => ctx.callService({ id: '2', version: '0.0.0' }, ctx.contextId).then(response => { console.log(response) }));
        document.getElementById("btnChild4").addEventListener('click', () => {
          ctx.callService({ id: 'child4', version: '0.0.0' }, '').then(response => { console.log(response) })
        });
        document.getElementById("btnChild1").addEventListener('click', () => {
          ctx.callService({ id: 'child1', version: '0.0.0' }, '').then(response => { console.log(response) })
        });
        document.getElementById("btnChild2").addEventListener('click', () => {
          ctx.callService({ id: 'child2', version: '0.0.0' }, '').then(response => { console.log(response) })
        });
        document.getElementById("btnChild3").addEventListener('click', () => {
          ctx.callService({ id: 'child3', version: '0.0.0' }, '').then(response => { console.log(response) })
        });
        document.getElementById("getTime").addEventListener('click', () => {
          ctx.callService({ id: 'time', version: '0.0.0' }, '').then(response => {
            console.log(`I am context ${ctx.contextId}, receiving the value ${response}`)
            const dateDisplayElement = document.getElementById('date');
            dateDisplayElement.innerText = new Date(response).toLocaleDateString();
            dateDisplayElement.style.display = 'block';
          });
        });
        document.getElementById("notifyBtn").addEventListener('click', () => {
          ctx.callService({ id: 'notification', version: '0.0.0' }, 'notify', [`notification from child ${ctx.contextId}`])
        });

        document.getElementById("registerChildBtn").addEventListener('click', () => {
          ctx.registerChildContext('./child4.html');
        });
        context = ctx;
      });
  </script>

  <h2>Child 2</h2>
  <p id='contextId'></p>
  <button id="btn2">call service 2</button>
  <button id="btnChild1">call child1 service</button>
  <button id="btnChild2">call child2 service</button>
  <button id="btnChild3">call child3 service</button>
  <button id="btnChild4">call child4 service</button>

  <button id="registerChildBtn">register Fragment</button>
  <button id="getTime">getTime</button>
  <button id="notifyBtn">trigger notification</button>
  <p id="date"></p>

  <div id="davinci-mfo-container" class="wrapper iframe-container"></div>


</body>

</html>
